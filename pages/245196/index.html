<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Python爬虫系列之urllib | WenAn&#39;s blog</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <script language="javascript" type="text/javascript" src="/js/pgmanor-self.js"></script>
    <meta name="description" content="web前端后端技术博客,简洁至上,专注web前端后端学习与总结。JavaScript,js,ES6,TypeScript,vue,python,java,css3,html5,Node,git,github等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#0e7415">
    <link rel="preload" href="/assets/css/0.styles.5855743d.css" as="style"><link rel="preload" href="/assets/js/app.15790d56.js" as="script"><link rel="preload" href="/assets/js/2.e9821628.js" as="script"><link rel="preload" href="/assets/js/10.c6b7b7e0.js" as="script"><link rel="prefetch" href="/assets/js/11.115a4f25.js"><link rel="prefetch" href="/assets/js/12.5ff1b78a.js"><link rel="prefetch" href="/assets/js/13.c5ec9bc0.js"><link rel="prefetch" href="/assets/js/14.327ddbbe.js"><link rel="prefetch" href="/assets/js/15.1fa1262c.js"><link rel="prefetch" href="/assets/js/16.51899e99.js"><link rel="prefetch" href="/assets/js/17.36611df9.js"><link rel="prefetch" href="/assets/js/18.afa32045.js"><link rel="prefetch" href="/assets/js/3.8236ce55.js"><link rel="prefetch" href="/assets/js/4.0723a8f2.js"><link rel="prefetch" href="/assets/js/5.cbee5800.js"><link rel="prefetch" href="/assets/js/6.47221dbf.js"><link rel="prefetch" href="/assets/js/7.84154062.js"><link rel="prefetch" href="/assets/js/8.cf5acc09.js"><link rel="prefetch" href="/assets/js/9.d2936119.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5855743d.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/nav_logo.png" alt="WenAn's blog" class="logo"> <span class="site-name can-hide">WenAn's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><a href="/python/" class="link-title">Python</a> <span class="title" style="display:none;">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Python语法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bef152/" class="nav-link">Python基础语法</a></li></ul></li><li class="dropdown-item"><h4>Python爬虫</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/245196/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Urllib</a></li></ul></li><li class="dropdown-item"><h4>Python数据分析</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/1a9b65/" class="nav-link">数据分析</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Coding" class="dropdown-title"><a href="/coding/" class="link-title">Coding</a> <span class="title" style="display:none;">Coding</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">Python</a></li></ul></div></div><div class="nav-item"><a href="/tips/" class="nav-link">Tips</a></div><div class="nav-item"><a href="/others/" class="nav-link">Others</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/cwenan/blog.img/20210924193442.jpg"> <div class="blogger-info"><h3>WenAn_Chen</h3> <span>面向Bug开发</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Python" class="dropdown-title"><a href="/python/" class="link-title">Python</a> <span class="title" style="display:none;">Python</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Python语法</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/bef152/" class="nav-link">Python基础语法</a></li></ul></li><li class="dropdown-item"><h4>Python爬虫</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/245196/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Urllib</a></li></ul></li><li class="dropdown-item"><h4>Python数据分析</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/1a9b65/" class="nav-link">数据分析</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Coding" class="dropdown-title"><a href="/coding/" class="link-title">Coding</a> <span class="title" style="display:none;">Coding</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">Python</a></li></ul></div></div><div class="nav-item"><a href="/tips/" class="nav-link">Tips</a></div><div class="nav-item"><a href="/others/" class="nav-link">Others</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Python</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Python基础语法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Python爬虫</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/245196/" aria-current="page" class="active sidebar-link">Python爬虫系列之urllib</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/245196/#_1-背景" class="sidebar-link">1.背景</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/245196/#_1-1-初识爬虫" class="sidebar-link">1.1 初识爬虫</a></li><li class="sidebar-sub-header"><a href="/pages/245196/#_1-2-合法性" class="sidebar-link">1.2 合法性</a></li><li class="sidebar-sub-header"><a href="/pages/245196/#_1-3-robots协议" class="sidebar-link">1.3 robots协议</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/245196/#_2-要求" class="sidebar-link">2.要求</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/245196/#_2-1-当前开发环境" class="sidebar-link">2.1 当前开发环境</a></li><li class="sidebar-sub-header"><a href="/pages/245196/#_2-2-编程基础" class="sidebar-link">2.2 编程基础</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/245196/#_3-快速上手urllib" class="sidebar-link">3.快速上手Urllib</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/245196/#_3-1-request模块" class="sidebar-link">3.1 request模块</a></li><li class="sidebar-sub-header"><a href="/pages/245196/#_3-2error-模块" class="sidebar-link">3.2Error 模块</a></li><li class="sidebar-sub-header"><a href="/pages/245196/#_3-3parse-模块" class="sidebar-link">3.3Parse 模块</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/245196/#_4-高级应用" class="sidebar-link">4.高级应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/245196/#_4-1-opener" class="sidebar-link">4.1 Opener</a></li><li class="sidebar-sub-header"><a href="/pages/245196/#_4-2-代理设置" class="sidebar-link">4.2 代理设置</a></li><li class="sidebar-sub-header"><a href="/pages/245196/#_4-3-cookie" class="sidebar-link">4.3 Cookie</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Python数据分析</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li></ul> <div class="sidebar-slot sidebar-slot-bottom"><!-- 正方形 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="3508773082"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div></aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/coding" title="coding-目录页" data-v-1cd794fe>coding</a></li> <li data-v-1cd794fe><a href="/coding/#Python" title="coding#Python" data-v-1cd794fe>Python</a></li> <li data-v-1cd794fe><a href="/coding/#Python爬虫" title="coding#Python爬虫" data-v-1cd794fe>Python爬虫</a></li></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/cwenan" target="_blank" title="作者" class="beLink" data-v-1cd794fe>问安</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2021-09-22</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">
          Python爬虫系列之urllib
        </h1> <div class="page-slot page-slot-top"><!-- 固定100% * 90px可显示，max-height:90px未见显示-->
     <ins class="adsbygoogle"
          style="display:inline-block;width:100%;max-height:90px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6625304284"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="theme-vdoing-content content__default"><h2 id="_1-背景"><a href="#_1-背景" class="header-anchor">#</a> 1.背景</h2> <h3 id="_1-1-初识爬虫"><a href="#_1-1-初识爬虫" class="header-anchor">#</a> 1.1 初识爬虫</h3> <p>网络爬虫，是一种按照一定规则，自动抓取互联网信息的程序或者脚本，其<strong>本质是模拟浏览器打开网页</strong>，获取网页中我们想要的数据。常用的百度、谷歌的搜索引擎也是一个爬虫，把互联网中的数据搜集组合起来便于用户检索。</p> <h3 id="_1-2-合法性"><a href="#_1-2-合法性" class="header-anchor">#</a> 1.2 合法性</h3> <p>网络爬虫领域当前还属于拓荒阶段， “ 允许哪些行为 ” 这种基本秩序还处于建设之中。如果抓取的数据属于个人使用或科研范畴，基本不存在问题; 如果数据属于商业盈利范畴，就要就事而论，可能违法，可能不违法。</p> <h3 id="_1-3-robots协议"><a href="#_1-3-robots协议" class="header-anchor">#</a> 1.3 robots协议</h3> <p>Robots协议(也称为爬虫协议、机器人协议等)的全称是“网络爬虫排除标准”(Robots Exclusion Protocol),内容网站通过Robots协议告诉搜索引擎怎样更高效的索引到结果页并提供给用户。它规定了网站里的哪些内容可以抓取，哪些不可以抓取，大部分网站都会有一个robots协议，一般存在网站的根目录下，命名为robots.txt,以知乎为例，https://www.zhihu.com/robots.txt</p> <p><img src="https://cdn.jsdelivr.net/gh/cwenan/blog.img/20210921114032.png" alt="image-20210918100651103"></p> <p>但robots协议终究是业内的一个约定，到底如何做还得看使用者。在使用爬虫时，应稍微克制一下行为，而不是使劲的薅，看看12306都惨成啥样了，被各种抢票软件，各路爬虫疯狂输出……</p> <h2 id="_2-要求"><a href="#_2-要求" class="header-anchor">#</a> 2.要求</h2> <h3 id="_2-1-当前开发环境"><a href="#_2-1-当前开发环境" class="header-anchor">#</a> 2.1 当前开发环境</h3> <ul><li>操作系统：Window 10</li> <li>python版本：3.8</li> <li>编辑器：pycharm</li> <li>库管理：Anconda</li></ul> <blockquote><p>以上是我电脑的配置，python版本起码3+；编辑器不限制，看自己喜欢；Anconda是真的好用，早用早享受</p></blockquote> <h3 id="_2-2-编程基础"><a href="#_2-2-编程基础" class="header-anchor">#</a> 2.2 编程基础</h3> <ul><li>要有一定的前端知识，会HTML，CSS，JS的基础用法</li> <li>懂得Python的基础语法</li></ul> <h2 id="_3-快速上手urllib"><a href="#_3-快速上手urllib" class="header-anchor">#</a> 3.快速上手Urllib</h2> <p>Urllib是python内置的一个http请求库，不需要额外的安装。只需要关注请求的链接，参数，提供了强大的解析功能</p> <p>Urllib库有四个模块：<strong>request，error， parse， robotparser</strong></p> <ol><li><strong>request：发起请求（重要）</strong></li> <li>error：处理错误</li> <li>parse：解析RUL或目录等</li> <li>robotparser(不怎么用)：解析网站的robot.txt</li></ol> <h3 id="_3-1-request模块"><a href="#_3-1-request模块" class="header-anchor">#</a> 3.1 request模块</h3> <p><strong>方法介绍：</strong></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token number">1</span><span class="token punctuation">.</span>请求方法
urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>timeout<span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token operator">*</span><span class="token punctuation">)</span>
url：地址，可以是字符串，也可以是一个Request对象
data：请求参数
timeout：设置超时
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>一个简单的get请求：</strong></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token triple-quoted-string string">&quot;&quot;&quot;
# 爬虫就是模拟用户，向服务器发起请求，服务器会返回对应数据
# 数据抓包，使用chrome，尽量不要使用国产浏览器
# F12打开界面，点击network，刷新，会显示网页的请求，常见的请求有GET, POST, PUT, DELETE, HEAD, OPTIONS, TRACE，其中GET 和 POST 最常用
# GET请求把请求参数都暴露在URL上
# POST请求的参数放在request body，一般会对密码进行加密
# 请求头：用来模拟一个真实用户
# 相应状态码：200表示成功
&quot;&quot;&quot;</span>


<span class="token comment"># 引入请求模块</span>
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token comment"># 发起请求,设置超时为1s</span>
response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com'</span><span class="token punctuation">,</span> timeout <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># 使用read()读取整个页面内容，使用decode('utf-8')对获取的内容进行编码</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token comment"># 状态码，判断是否成功,200</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>getheaders<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>       <span class="token comment"># 响应头 得到的一个元组组成的列表</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>getheader<span class="token punctuation">(</span><span class="token string">'Server'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">#得到特定的响应头</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>推荐一个测试网站，用于提交各种请求：http://httpbin.org/，该网站的更多的用法自行搜索</p> <p><strong>一个简单的post请求</strong></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token comment"># data需要的是字节流编码格式的内容，此时请求方式为post</span>
data <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;WenAn&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'http://httpbin.org/post'</span><span class="token punctuation">,</span> data<span class="token operator">=</span> data<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>Request对象</strong></p> <p>浏览器发起请求时都会有请求头header，爬虫想要爬取信息时，添加header，让服务器以为你是浏览器，而不是一个爬虫。urlopen无法添加其他参数，因此我们需要声明一个request对象来添加header</p> <p><strong>如何获取Header：</strong></p> <p>随便打开一个网页(以chrome为例)，快捷键F12或者右键打开开发者页面，点击network，<strong>刷新页面</strong>，再随便点击一个链接</p> <p><img src="https://cdn.jsdelivr.net/gh/cwenan/blog.img/20210921114015.png" alt="image-20210920154949003"></p> <p><img src="https://cdn.jsdelivr.net/gh/cwenan/blog.img/20210921114022.png" alt="image-20210920155109952"></p> <p><strong>Request介绍</strong></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
headers<span class="token punctuation">:</span> 定义请求头
method：默认为get，当传入参数时为post
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>例子：</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse

url <span class="token operator">=</span> <span class="token string">'http://httpbin.org/post'</span>
<span class="token comment"># 添加请求头</span>
headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'user-agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36(KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36'</span><span class="token punctuation">,</span> <span class="token string">'Host'</span><span class="token punctuation">:</span><span class="token string">'httpbin.org'</span><span class="token punctuation">}</span>
<span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'WenAn'</span>
<span class="token punctuation">}</span>
data <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>
request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token string">'POST'</span><span class="token punctuation">)</span>
response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_3-2error-模块"><a href="#_3-2error-模块" class="header-anchor">#</a> 3.2Error 模块</h3> <p>Error模块下有三个异常类：</p> <ul><li><strong>URLError</strong> <ul><li>处理程序在遇到问题时会引发此异常（或其派生的异常）</li> <li><strong>只有一个reason属性</strong></li></ul></li> <li><strong>HTTPError</strong> <ul><li><strong>是URLError的一个子类，有更多的属性，如code， reason，headers</strong></li> <li>适用于处理特殊 HTTP 错误例如作为认证请求的时候。</li></ul></li> <li><strong>ContentTooShortError</strong> <ul><li>此异常会在 <a href="https://docs.python.org/zh-cn/3/library/urllib.request.html#urllib.request.urlretrieve" target="_blank" rel="noopener noreferrer"><code>urlretrieve()</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 函数检测到已下载的数据量小于期待的数据量（由 <em>Content-Length</em> 头给定）时被引发。 <code>content</code> 属性中将存放已下载（可能被截断）的数据。</li></ul></li></ul> <p>例子1.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> urllib <span class="token keyword">import</span> request<span class="token punctuation">,</span> error
<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token comment"># 打开百度里面的a.html页面，因为它根本不存在，所以会抛出异常</span>
    response <span class="token operator">=</span> request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com/a.html'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> error<span class="token punctuation">.</span>URLError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>reason<span class="token punctuation">)</span> <span class="token comment">#Not Found</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>例子2.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 一样的例子，只不过把URLError换成了HTTPError</span>
<span class="token keyword">from</span> urllib <span class="token keyword">import</span> request<span class="token punctuation">,</span> error
<span class="token keyword">try</span><span class="token punctuation">:</span>
    response <span class="token operator">=</span> request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com/a.html'</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> error<span class="token punctuation">.</span>HTTPError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>code<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>

<span class="token comment"># 输出结果</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
Not Found

404

Content-Length: 204
Connection: keep-alive
Content-Type: text/html; charset=iso-8859-1
Date: Sat, 18 Sep 2021 14:18:51 GMT
Keep-Alive: timeout=4
Proxy-Connection: keep-alive
Server: Apache
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_3-3parse-模块"><a href="#_3-3parse-模块" class="header-anchor">#</a> 3.3Parse 模块</h3> <p>parse模块定义了url的标准接口，实现url的各种抽取，解析，合并，编码，解码</p> <p><strong>urlencode()介绍---参数编码</strong></p> <p>它将字典构形式的参数序列化为url编码后的字符串，在前面的request模块有用到</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse
<span class="token builtin">dict</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'WenAn'</span><span class="token punctuation">,</span>
    <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">20</span>
<span class="token punctuation">}</span>
params <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlencode<span class="token punctuation">(</span><span class="token builtin">dict</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
<span class="token comment"># name=WenAn&amp;age=20</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>quote()介绍---中文RUL编解码</strong></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse
params <span class="token operator">=</span> <span class="token string">'憨憨没了心'</span>
base_url <span class="token operator">=</span> <span class="token string">'https://www.baidu.com/s?wd='</span>
url <span class="token operator">=</span> base_url <span class="token operator">+</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>params<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token comment"># https://www.baidu.com/s?wd=%E6%86%A8%E6%86%A8%E6%B2%A1%E4%BA%86%E5%BF%83</span>

<span class="token comment"># 使用unquote()对中文解码</span>
url1 <span class="token operator">=</span> <span class="token string">'https://www.baidu.com/s?wd=%E6%86%A8%E6%86%A8%E6%B2%A1%E4%BA%86%E5%BF%83'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>unquote<span class="token punctuation">(</span>url1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># https://www.baidu.com/s?wd=憨憨没了心</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><strong>urlparse()介绍—-URL分段</strong></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlparse<span class="token punctuation">(</span>urlstring<span class="token punctuation">,</span> scheme<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> allow_fragments<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
urlstring：待解析的url
scheme<span class="token operator">=</span><span class="token string">''</span>：假如解析的url没有协议<span class="token punctuation">,</span>可以设置默认的协议<span class="token punctuation">,</span>如果url有协议，设置此参数无效
allow_fragments<span class="token operator">=</span><span class="token boolean">True</span>：是否忽略锚点、片断标识符，如<span class="token string">'#'</span> <span class="token punctuation">,</span>默认为<span class="token boolean">True</span>表示不忽略<span class="token punctuation">,</span>为<span class="token boolean">False</span>表示忽略
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>例子1.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> urlparse
a <span class="token operator">=</span> urlparse<span class="token punctuation">(</span><span class="token string">&quot;https://docs.python.org/zh-cn/3/library/urllib.parse.html&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token comment"># 返回一个数组，是url的拼接部分，可以访问具体的值</span>
<span class="token comment"># ParseResult(scheme='https', netloc='docs.python.org', path='/zh-cn/3/library/urllib.parse.html', params='', query='', fragment='')</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>scheme<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>netloc<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>path<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>query<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>fragment<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
scheme:表示协议
netloc:域名
path:路径
params:参数
query:查询条件，一般都是get请求的url
fragment:锚点，用于直接定位页面的下拉位置，跳转到网页的指定位置
&quot;&quot;&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><strong>urlunparse()介绍----URL构造</strong></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse
url_params <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">,</span> <span class="token string">'baidu.com'</span><span class="token punctuation">,</span> <span class="token string">'/a'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
url <span class="token operator">=</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>urlunparse<span class="token punctuation">(</span>url_params<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>

<span class="token comment">#http://baidu.com/a</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>urljoin()介绍----URL拼接</strong></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token comment"># 给一个基础url，给一个后缀url，进行拼接</span>
<span class="token keyword">from</span> urllib <span class="token keyword">import</span> parse
base_url <span class="token operator">=</span> <span class="token string">'http://www.cwi.nl/%7Eguido/Python.html'</span>
sub_url <span class="token operator">=</span> <span class="token string">'FAQ.html'</span>
url <span class="token operator">=</span> parse<span class="token punctuation">.</span>urljoin<span class="token punctuation">(</span>base_url<span class="token punctuation">,</span> sub_url<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
<span class="token comment"># http://www.cwi.nl/%7Eguido/FAQ.html</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_4-高级应用"><a href="#_4-高级应用" class="header-anchor">#</a> 4.高级应用</h2> <h3 id="_4-1-opener"><a href="#_4-1-opener" class="header-anchor">#</a> <strong>4.1 Opener</strong></h3> <p>opener是 <code>urllib.request.OpenerDirector</code> 的实例，如上文提到的urlopen便是一个已经构建好的特殊opener，但urlopen()仅提供了最基本的功能，如不支持代理，cookie等</p> <p><strong>自定义Opener的流程</strong></p> <ul><li>使用相关的 Handler处理器来创建特定功能的处理器对象</li> <li>通过 urllib.request.build_opener()方法使用处理器对象，创建自定义opener对象</li> <li>使用自定义的opener对象，调用open()方法发送请求</li></ul> <p><strong>关于全局Opener</strong></p> <p>如果要求程序里面的所有请求都使用自定义的opener，使用<code>urllib.request.install_opener()</code></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token comment"># 创建handler</span>
http_handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>HTTPHandler<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 创建opener</span>
opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>http_handler<span class="token punctuation">)</span>
<span class="token comment"># 创建Request对象</span>
request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span><span class="token string">'https://www.python.org/'</span><span class="token punctuation">)</span>

<span class="token comment"># 局部opener,只能使用.open()来访问</span>
<span class="token comment"># response = opener.open(request)</span>


<span class="token comment"># 全局opener，之后调用urlopen，都将使用这个自定义opener</span>
urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>install_opener<span class="token punctuation">(</span>opener<span class="token punctuation">)</span>
response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_4-2-代理设置"><a href="#_4-2-代理设置" class="header-anchor">#</a> 4.2 代理设置</h3> <p><strong>代理原理</strong></p> <p>正常流程：本机请求访问一个网站，把请求发给Web服务器，Web服务器把相应数据传回。</p> <p>使用代理：本机和服务器之间出现了第三方，本机向代理服务器发出请求，代理服务器向Web服务器发出请求，相应数据通过代理服务器转发回到本机</p> <p>区别：Web服务器识别出的IP只是代理服务器的IP，而不是本机的IP，从而实现了IP伪装</p> <hr> <p>使用代理IP，可以更方便的爬取数据。很多网站会在某个时间段内检查某个IP的访问次数，如果访问次数过高出现异常，便会封禁该IP，禁止其访问网站。使用代理便可以每隔一个时间段换一个代理，如果某个IP被禁了，换个IP便可继续爬取数据。</p> <p>这里推荐几个提供免费代理服务的网站：</p> <ul><li>http://www.xiladaili.com/</li> <li>https://www.kuaidaili.com/free/</li> <li>https://ip.jiangxianli.com/?page=1</li></ul> <p>更多的IP自己去网上搜索，谁也不能保证这些免费ip能用到啥时候</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request

<span class="token comment"># 创建handler</span>
proxy_handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>ProxyHandler<span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string">'http'</span><span class="token punctuation">:</span> <span class="token string">'218.78.22.146:443'</span><span class="token punctuation">,</span>
    <span class="token string">'http'</span><span class="token punctuation">:</span> <span class="token string">'223.100.166.3'</span><span class="token punctuation">,</span>
    <span class="token string">'http'</span><span class="token punctuation">:</span> <span class="token string">'113.254.178.224'</span><span class="token punctuation">,</span>
    <span class="token string">'http'</span><span class="token punctuation">:</span> <span class="token string">'115.29.170.58'</span><span class="token punctuation">,</span>
    <span class="token string">'http'</span><span class="token punctuation">:</span> <span class="token string">'117.94.222.233'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 创建opener</span>
opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>proxy_handler<span class="token punctuation">)</span>
header <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;User-Agent&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.82 Safari/537.36&quot;</span>
<span class="token punctuation">}</span>
request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span><span class="token string">'https://www.httpbin.org/get'</span><span class="token punctuation">,</span> headers<span class="token operator">=</span>header<span class="token punctuation">)</span>

<span class="token comment"># 配置全局opener</span>
urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>install_opener<span class="token punctuation">(</span>opener<span class="token punctuation">)</span>
response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_4-3-cookie"><a href="#_4-3-cookie" class="header-anchor">#</a> 4.3 Cookie</h3> <p>Cookie是网站为了识别用户身份而存储在用户本地端的数据，该数据通常经过加密。</p> <p>Cookie 主要用于以下三个方面：</p> <ul><li>会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）</li> <li>个性化设置（如用户自定义设置、主题等）</li> <li>浏览器行为跟踪（如跟踪分析用户行为等）</li></ul> <p><strong>cookielib库</strong></p> <p>该模块主要功能是提供可存储cookie的对象。使用此模块捕获cookie并在后续连接请求时重新发送，还可以用来处理包含cookie数据的文件。</p> <p>这个模块主要提供了这几个对象，<strong>CookieJar，FileCookieJar，MozillaCookieJar,LWPCookieJar</strong>。</p> <ul><li>CookieJar：<strong>对象存储在内存中</strong></li> <li>FileCookieJar，MozillaCookieJar，LWPCookieJar：<strong>存储在文件中</strong>，生成<strong>对应格式</strong>的cookie文件，一般使用某两种</li></ul> <p><strong>获取Cookie</strong></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> http<span class="token punctuation">.</span>cookiejar
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token comment"># 创建cookie对象</span>
cookie <span class="token operator">=</span> http<span class="token punctuation">.</span>cookiejar<span class="token punctuation">.</span>CookieJar<span class="token punctuation">(</span><span class="token punctuation">)</span>
handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>HTTPCookieProcessor<span class="token punctuation">(</span>cookie<span class="token punctuation">)</span>
opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>
response <span class="token operator">=</span> opener<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'http://www.baidu.com'</span><span class="token punctuation">)</span>
<span class="token comment"># 在获取response后cookie会被自动赋值</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> cookie<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">&quot;=&quot;</span><span class="token operator">+</span>i<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>保存Cookie到本地</strong></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> http<span class="token punctuation">.</span>cookiejar
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request

filename <span class="token operator">=</span> <span class="token string">'cookie.txt'</span>
<span class="token comment"># cookie = http.cookiejar.MozillaCookieJar(filename)</span>
cookie <span class="token operator">=</span> http<span class="token punctuation">.</span>cookiejar<span class="token punctuation">.</span>LWPCookieJar<span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>HTTPCookieProcessor<span class="token punctuation">(</span>cookie<span class="token punctuation">)</span>
opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>
<span class="token comment"># 获取response后cookie会被自动赋值</span>
response <span class="token operator">=</span> opener<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'http://www.baidu.com'</span><span class="token punctuation">)</span>
<span class="token comment"># 保存cookie.txt文件</span>
cookie<span class="token punctuation">.</span>save<span class="token punctuation">(</span>ignore_discard<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> ignore_expires<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>读取Cookie文件</strong></p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token keyword">import</span> http<span class="token punctuation">.</span>cookiejar

<span class="token comment"># cookie对象要和生产cookie文件的对象保持一致，是LWP还是Mozilla</span>
<span class="token comment"># cookie = http.cookiejar.MozillaCookieJar</span>
cookie <span class="token operator">=</span> http<span class="token punctuation">.</span>cookiejar<span class="token punctuation">.</span>LWPCookieJar<span class="token punctuation">(</span><span class="token punctuation">)</span>
cookie<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'cookie.txt'</span><span class="token punctuation">,</span> ignore_expires<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> ignore_discard<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
handler <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>HTTPCookieProcessor<span class="token punctuation">(</span>cookie<span class="token punctuation">)</span>
opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span>handler<span class="token punctuation">)</span>
response <span class="token operator">=</span> opener<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">&quot;http://www.baidu.com&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>以上便是urllib的常用内容</p> <p>附上urllib参考文档：https://docs.python.org/zh-cn/3/library/urllib.html</p></div></div> <div class="page-slot page-slot-bottom"><!-- 横向自适应 -->
      <ins class="adsbygoogle"
          style="display:block"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="6620245489"
          data-ad-format="auto"
          data-full-width-responsive="true"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script></div> <div class="page-edit"><!----> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/09/25, 14:24:37</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/bef152/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">基础知识</div></a> <a href="/pages/1a9b65/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">用python进行数据分析</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/bef152/" class="prev">基础知识</a></span> <span class="next"><a href="/pages/1a9b65/">用python进行数据分析</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/bef152/"><div>基础知识</div></a> <span>09-22</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/1a9b65/"><div>用python进行数据分析</div></a> <span>09-22</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="wenangonzi@gmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/cwenan" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2021-2021
    <span>粤ICP备2020121415号-1</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <div class="custom-html-window custom-html-window-rb" style="display:;"><div class="custom-wrapper"><i class="close-but">×</i> <div><!-- 固定160*160px -->
      <ins class="adsbygoogle"
          style="display:inline-block;max-width:160px;max-height:160px"
          data-ad-client="ca-pub-7828333725993554"
          data-ad-slot="8377369658"></ins>
      <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
      </div></div></div></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.15790d56.js" defer></script><script src="/assets/js/2.e9821628.js" defer></script><script src="/assets/js/10.c6b7b7e0.js" defer></script>
  </body>
</html>